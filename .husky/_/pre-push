echo "ğŸš€ Preparing to push your code..."
echo "ğŸ” Step 1: Running ESLint to check for errors and fix minor issues..."
npx eslint --fix . 
ESLINT_EXIT_CODE=$?

if [ $ESLINT_EXIT_CODE -ne 0 ]; then
  echo "âŒ ESLint detected issues in the code!"
  echo "âš ï¸ Please check the logs above to see the exact problems."
  echo "ğŸ“Œ Common causes: Unused variables, incorrect imports, missing semicolons."
else
  echo "âœ… ESLint passed with no issues!"
fi

# Uncomment when tests are implemented
# echo "ğŸ§ª Step 2: Running tests to ensure application integrity..."
# npm test 
# TEST_EXIT_CODE=$?

# if [ $TEST_EXIT_CODE -ne 0 ]; then
#   echo "âŒ Some tests have failed!"
#   echo "âš ï¸ Please check the logs above to see what failed."
#   echo "ğŸ“Œ Common causes: Functionality breaks, API changes, missing mocks."
# else
#   echo "âœ… All tests passed successfully!"
# fi

echo "ğŸ› ï¸ Step 3: Running build process to detect compile-time issues..."
npm run build
BUILD_EXIT_CODE=$?

if [ $BUILD_EXIT_CODE -ne 0 ]; then
  echo "âŒ Build process failed!"
  echo "âš ï¸ Please check the logs above to see the exact errors."
  echo "ğŸ“Œ Common causes: TypeScript errors, missing dependencies, incorrect imports."
else
  echo "âœ… Build was successful!"
fi

# If any step failed, ask the developer if they want to proceed
if [ $ESLINT_EXIT_CODE -ne 0 ] || [ $BUILD_EXIT_CODE -ne 0 ]; then
  echo "ğŸš¨ ğŸš¨ ğŸš¨ WARNING: Issues detected! ğŸš¨ ğŸš¨ ğŸš¨"
  echo "â— ESLint, Tests, or Build failed. Pushing this code **may break the repository**."
  echo "âš ï¸ Hereâ€™s what went wrong:"
  
  if [ $ESLINT_EXIT_CODE -ne 0 ]; then
    echo "ğŸ”´ ESLint failed. Code quality issues detected."
  fi

  # Uncomment when tests are implemented
  # if [ $TEST_EXIT_CODE -ne 0 ]; then
  #   echo "ğŸ”´ Some tests failed. Functionality may be broken."
  # fi

  if [ $BUILD_EXIT_CODE -ne 0 ]; then
    echo "ğŸ”´ Build failed. The project will not run properly."
  fi

  echo "â“ Do you still want to push? **This code may break the repository or cause problems in the future** (yes/no)"
  read ANSWER
  if [ "$ANSWER" != "yes" ]; then
    echo "ğŸš« Push canceled by user. Fix the issues and try again!"
    exit 1
  else
    echo "âš ï¸ **You willingly chose to push with issues**. Proceeding..."
  fi
fi

echo "âœ… Push is proceeding... Be mindful of the warnings above."
